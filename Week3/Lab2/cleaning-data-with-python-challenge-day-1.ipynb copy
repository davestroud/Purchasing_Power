{"cells":[{"metadata":{"_cell_guid":"e98ff021-12c8-450f-a3a3-eae7affb1d7e","_uuid":"e89c30b819f5b588f522435339609468e5bf6939"},"cell_type":"markdown","source":"# Data cleaning challenge day 1 - Handling missing values\n\nWell, I've been meaning to start a more structured attack on building my Python knowledge. At the moment, I'm lost in the comfort of doing things in R. For a lot of purposes, I'll probably stick to it, however, being able to do everything (or most of the things) I do in R in Python would certainly have its advantages.\n\nFor example, at the moment our company website is built using Python on a Django framework. It would certainly be handy to be able to perform analyses, run reports and build dashboards directly on the backend of the website...\n\nSo, time to hit [Day 1 of Rachael's challenge][1], and cleaning the data is a good place to start.\n\n[1]: https://www.kaggle.com/rtatman/data-cleaning-challenge-handling-missing-values/notebook"},{"metadata":{"_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","_kg_hide-output":true,"_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","trusted":false},"cell_type":"code","source":"# import numpy and pandas\n\nimport numpy as np # linear algebra\nimport pandas as pd # data processing, CSV file I/O (e.g. pd.read_csv)\n\n# read in the San Francisco building permits data\nsfPermits = pd.read_csv(\"../input/Building_Permits.csv\")\n\n# set seed for reproducibility\nnp.random.seed(0)","execution_count":21,"outputs":[]},{"metadata":{"_uuid":"45d5063ed74046a3696c66b2cd92dd099ada3846"},"cell_type":"markdown","source":"### Look at a couple of rows from the sf_permits dataset. Do you notice any missing data?"},{"metadata":{"trusted":false,"_uuid":"53543ea909e946534c5d701ad926536f7b43aa7e"},"cell_type":"code","source":"sfPermits.sample(5)","execution_count":22,"outputs":[]},{"metadata":{"_uuid":"dea558f0cbad3065f0b944e69a035ad8167d35d2"},"cell_type":"markdown","source":"Quite a few missing values visible already, and we've only looked at the first five rows of the dataset, cleaning will be required...\n\n### Find out what percent of the sf_permit dataset is missing"},{"metadata":{"trusted":false,"_uuid":"5194f311b570390e9e7cc678c3ae1c5b1a66980d"},"cell_type":"code","source":"# Calculate total number of cells in dataframe\ntotalCells = np.product(sfPermits.shape)\n\n# Count number of missing values per column\nmissingCount = sfPermits.isnull().sum()\n\n# Calculate total number of missing values\ntotalMissing = missingCount.sum()\n\n# Calculate percentage of missing values\nprint(\"The SF Permits dataset contains\", round(((totalMissing/totalCells) * 100), 2), \"%\", \"missing values.\")\n","execution_count":23,"outputs":[]},{"metadata":{"_uuid":"db1de6f9100c7b155f61c70b7f2372fd4f4d97b8"},"cell_type":"markdown","source":"### Look at the columns Street Number Suffix and Zipcode from the sf_permits datasets. Both of these contain missing values. Which, if either, of these are missing because they don't exist? Which, if either, are missing because they weren't recorded?"},{"metadata":{"trusted":false,"_uuid":"1504e31c355a7a238dda785a3ccf97e12dc29668"},"cell_type":"code","source":"missingCount[['Street Number Suffix', 'Zipcode']]\n","execution_count":24,"outputs":[]},{"metadata":{"_uuid":"20238fe5873ea273ad4f27835ba5f15ac44a44d2"},"cell_type":"markdown","source":"Looks like a lot more missing values for street number suffix than zipcode. Let's check out the percentages:"},{"metadata":{"trusted":false,"_uuid":"79b0e8fa2f74f3cfd98dbf8d7564b81f4dee7160"},"cell_type":"code","source":"print(\"Percent missing data in Street Number Suffix column =\", (round(((missingCount['Street Number Suffix'] / sfPermits.shape[0]) * 100), 2)))\nprint(\"Percent missing data in Zipcode column =\", (round(((missingCount['Zipcode'] / sfPermits.shape[0]) * 100), 2)))","execution_count":31,"outputs":[]},{"metadata":{"_uuid":"b83ceec8f2581ca5de9252e5f31da1adcf99ee40"},"cell_type":"markdown","source":"As every address has a Zipcode, it looks like the missing values for this column are due to the values not being recorded. For the Street Number Suffix column, it is likely very few properties will have a suffix to the number, I see a lot of 3s, 18s, 46s, but not nearly as many 36A or 18B, so it is likely that these are missing as they don't exist.\n\n### Try removing all the rows from the sf_permits dataset that contain missing values. How many are left?"},{"metadata":{"trusted":false,"_uuid":"fd67f104874da78bbca79041d43efd4fd3c86109"},"cell_type":"code","source":"sfPermits.dropna()","execution_count":32,"outputs":[]},{"metadata":{"_uuid":"0f6a4bab35adef2a63eb9c05fc7511ec90cdec8b"},"cell_type":"markdown","source":"If we drop all rows that contain a missing value, we greatly simplify our dataset. So simple, we can go for an early lunch. Every row contains at least one missing value (well, we know from our Street Number Suffix answer above that simply eliminating those gets rid of nearly 99% of our data), so we end up with a dataframe of column headers.\n\n### Now try removing all the columns with empty values. Now how much of your data is left?"},{"metadata":{"trusted":false,"_uuid":"2329d8d58aec4aac02a0a7c06c4fbe05d79e1982"},"cell_type":"code","source":"sfPermitsCleanCols = sfPermits.dropna(axis=1)\nsfPermitsCleanCols.head()","execution_count":35,"outputs":[]},{"metadata":{"trusted":false,"_uuid":"e30c226e75f60b103d83be0f1b3fd41c3821b8c8"},"cell_type":"code","source":"print(\"Columns in original dataset: %d \\n\" % sfPermits.shape[1])\nprint(\"Columns with na's dropped: %d\" % sfPermitsCleanCols.shape[1])","execution_count":36,"outputs":[]},{"metadata":{"_uuid":"21c24745f460ca25eb8475472c947c1740836b47"},"cell_type":"markdown","source":"Well, that gives us a clean set of values, but we've sacrificed a lot of variables in the process...\n\n### Your turn! Try replacing all the NaN's in the sf_permit data with the one that comes directly after it and then [replace all the reamining na's with 0]"},{"metadata":{"trusted":false,"_uuid":"18cb73b279d63d31bae59b41e260c665a0184d35"},"cell_type":"code","source":"imputeSfPermits = sfPermits.fillna(method='ffill', axis=0).fillna(\"0\")\n\nimputeSfPermits.head()","execution_count":39,"outputs":[]},{"metadata":{"_cell_guid":"79c7e3d0-c299-4dcb-8224-4455121ee9b0","_uuid":"d629ff2d2480ee46fbb7e2d37f6b5fab8052498a","collapsed":true},"cell_type":"markdown","source":"That's certainly a nicer way to do things, but still quite a simplistic method. For EDA and preliminary analysis it's a good way to get started, but choosing an imputation method based on the type of data in each column would be a logical next step.\n\nEither way, coming from R, it's been a good exercise to start getting my Python more up to scratch; thanks Rachael!"}],"metadata":{"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"name":"python","version":"3.6.4","mimetype":"text/x-python","codemirror_mode":{"name":"ipython","version":3},"pygments_lexer":"ipython3","nbconvert_exporter":"python","file_extension":".py"}},"nbformat":4,"nbformat_minor":1}